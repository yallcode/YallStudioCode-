<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YallStudioCode</title>
<link rel="icon" href="icon.png" type="image/png">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f10;
    --sidebar-bg: #161618;
    --tab-bg: #1a1a1c;
    --editor-bg: #111113;
    --panel-bg: #141416;
    --border: #2a2a2e;
    --accent: #f5a623;
    --accent2: #e85d4a;
    --accent3: #4af0a0;
    --text: #d4d4d8;
    --text-dim: #71717a;
    --text-bright: #fafafa;
    --line-num: #3f3f46;
    --selection: rgba(245,166,35,0.15);
    --hover: rgba(255,255,255,0.04);
    --active: rgba(245,166,35,0.08);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; overflow:hidden; }
  body {
    font-family: 'JetBrains Mono', monospace;
    background: var(--bg);
    color: var(--text);
    display:flex;
    flex-direction:column;
    height:100vh;
    user-select:none;
  }

  /* TITLE BAR */
  #titlebar {
    height: 38px;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 12px;
    flex-shrink: 0;
    -webkit-app-region: drag;
  }
  #titlebar .logo {
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 13px;
    color: var(--accent);
    letter-spacing: 0.5px;
  }
  #titlebar .logo img { width:18px; height:18px; object-fit:contain; }
  #titlebar .logo span { color: var(--text-bright); }
  #titlebar .logo span em { color: var(--accent); font-style:normal; }
  .menu-bar {
    display: flex;
    align-items: center;
    gap: 2px;
    margin-left: 8px;
    -webkit-app-region: no-drag;
  }
  .menu-bar button {
    background: none;
    border: none;
    color: var(--text-dim);
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'Syne', sans-serif;
    transition: all .15s;
  }
  .menu-bar button:hover { background: var(--hover); color: var(--text-bright); }
  .title-center {
    flex: 1;
    text-align: center;
    font-size: 11px;
    color: var(--text-dim);
    font-family: 'Syne', sans-serif;
  }
  .win-controls {
    display: flex;
    gap: 6px;
    -webkit-app-region: no-drag;
  }
  .win-btn {
    width: 12px; height: 12px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
  }
  .win-close { background: #ff5f57; }
  .win-min { background: #febc2e; }
  .win-max { background: #28c840; }

  /* MAIN LAYOUT */
  #app { display:flex; flex:1; overflow:hidden; }

  /* ACTIVITY BAR */
  #activitybar {
    width: 48px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    gap: 2px;
    flex-shrink: 0;
  }
  .act-btn {
    width: 36px; height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-dim);
    font-size: 18px;
    transition: all .15s;
    position: relative;
  }
  .act-btn:hover { color: var(--text-bright); background: var(--hover); }
  .act-btn.active { color: var(--accent); background: var(--active); }
  .act-btn.active::before {
    content: '';
    position: absolute;
    left: -4px;
    width: 3px;
    height: 60%;
    background: var(--accent);
    border-radius: 0 2px 2px 0;
  }
  #activitybar .spacer { flex:1; }

  /* SIDEBAR */
  #sidebar {
    width: 220px;
    background: var(--sidebar-bg);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    overflow: hidden;
  }
  .sidebar-header {
    padding: 10px 12px 6px;
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 700;
    color: var(--text-dim);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .sidebar-header .icon-btn {
    background: none; border: none;
    color: var(--text-dim);
    cursor: pointer; font-size: 14px;
    padding: 2px 4px; border-radius: 3px;
  }
  .sidebar-header .icon-btn:hover { color: var(--text-bright); background: var(--hover); }
  #file-tree { flex:1; overflow-y:auto; padding: 4px 0; }
  #file-tree::-webkit-scrollbar { width: 4px; }
  #file-tree::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .tree-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 3px 8px 3px 16px;
    font-size: 12.5px;
    cursor: pointer;
    border-radius: 4px;
    margin: 0 4px;
    transition: background .1s;
    white-space: nowrap;
  }
  .tree-item:hover { background: var(--hover); }
  .tree-item.active { background: var(--active); color: var(--text-bright); }
  .tree-item .fi { font-size: 13px; }
  .tree-folder {
    padding-left: 8px;
    font-weight: 600;
    color: var(--text-bright);
    font-family: 'Syne', sans-serif;
  }
  .tree-folder .arrow { font-size: 10px; color: var(--text-dim); transition: transform .15s; }
  .tree-folder.open .arrow { transform: rotate(90deg); }

  /* EDITOR AREA */
  #editor-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    background: var(--editor-bg);
  }

  /* TABS */
  #tabs {
    height: 36px;
    background: var(--tab-bg);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: flex-end;
    overflow-x: auto;
    flex-shrink: 0;
  }
  #tabs::-webkit-scrollbar { height: 0; }
  .tab {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 14px;
    height: 34px;
    font-size: 12px;
    cursor: pointer;
    border-right: 1px solid var(--border);
    color: var(--text-dim);
    white-space: nowrap;
    transition: all .15s;
    position: relative;
    flex-shrink: 0;
  }
  .tab:hover { background: var(--hover); color: var(--text); }
  .tab.active {
    background: var(--editor-bg);
    color: var(--text-bright);
    border-bottom: 2px solid var(--accent);
  }
  .tab .close {
    font-size: 14px; opacity: 0;
    transition: opacity .15s;
    width: 16px; height: 16px;
    display: flex; align-items:center; justify-content:center;
    border-radius: 3px;
  }
  .tab:hover .close { opacity: 0.6; }
  .tab .close:hover { opacity: 1; background: rgba(255,255,255,0.1); }
  .tab-icon { font-size: 13px; }
  .tab-new {
    padding: 0 12px;
    height: 34px;
    display: flex; align-items:center;
    cursor: pointer;
    color: var(--text-dim);
    font-size: 18px;
    transition: all .15s;
  }
  .tab-new:hover { color: var(--text-bright); background: var(--hover); }

  /* EDITOR CONTENT */
  #editor-wrapper {
    flex: 1;
    display: flex;
    overflow: hidden;
  }
  #line-numbers {
    width: 50px;
    background: var(--editor-bg);
    padding: 16px 0;
    text-align: right;
    font-size: 13px;
    line-height: 1.65;
    color: var(--line-num);
    flex-shrink: 0;
    overflow: hidden;
    padding-right: 12px;
    border-right: 1px solid var(--border);
    user-select: none;
  }
  #editor {
    flex: 1;
    background: var(--editor-bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.65;
    padding: 16px 16px;
    border: none;
    outline: none;
    resize: none;
    tab-size: 2;
    overflow: auto;
    white-space: pre;
    caret-color: var(--accent);
    user-select: text;
  }
  #editor::-webkit-scrollbar { width: 8px; height: 8px; }
  #editor::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
  #editor::selection { background: var(--selection); }

  /* SYNTAX HIGHLIGHT OVERLAY */
  #highlight-view {
    position: absolute;
    pointer-events: none;
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    line-height: 1.65;
    padding: 16px 16px;
    white-space: pre;
    word-wrap: normal;
    top: 0; left: 0; right: 0;
    color: transparent;
  }

  /* BOTTOM PANEL */
  #panel {
    height: 160px;
    background: var(--panel-bg);
    border-top: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
  }
  .panel-tabs {
    display: flex;
    border-bottom: 1px solid var(--border);
    height: 30px;
    align-items: center;
  }
  .panel-tab {
    padding: 0 14px;
    height: 30px;
    display: flex;
    align-items: center;
    font-size: 11px;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    cursor: pointer;
    color: var(--text-dim);
    letter-spacing: 0.5px;
    transition: all .15s;
    border-bottom: 2px solid transparent;
  }
  .panel-tab.active { color: var(--accent); border-bottom-color: var(--accent); }
  .panel-tab:hover:not(.active) { color: var(--text); }
  #terminal {
    flex: 1;
    padding: 8px 14px;
    font-size: 12px;
    overflow-y: auto;
    color: var(--text);
  }
  #terminal::-webkit-scrollbar { width: 4px; }
  #terminal::-webkit-scrollbar-thumb { background: var(--border); }
  .term-line { line-height: 1.7; }
  .term-prompt { color: var(--accent3); }
  .term-path { color: var(--accent); }
  .term-output { color: var(--text-dim); }
  .term-error { color: var(--accent2); }
  #term-input-line {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 0 14px 8px;
  }
  .term-input-prompt { color: var(--accent3); font-size: 12px; white-space: nowrap; }
  #term-input {
    flex: 1;
    background: none;
    border: none;
    color: var(--text-bright);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    outline: none;
    caret-color: var(--accent);
  }

  /* STATUS BAR */
  #statusbar {
    height: 24px;
    background: var(--accent);
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 16px;
    flex-shrink: 0;
  }
  .status-item {
    font-size: 11px;
    font-family: 'Syne', sans-serif;
    font-weight: 600;
    color: #000;
    display: flex;
    align-items: center;
    gap: 4px;
    opacity: 0.85;
    cursor: pointer;
  }
  .status-item:hover { opacity: 1; }
  .status-right { margin-left: auto; display:flex; gap:16px; }
  #status-cursor { margin-left: auto; }

  /* WELCOME SCREEN */
  #welcome {
    flex:1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 40px;
  }
  .welcome-logo {
    font-family: 'Syne', sans-serif;
    font-size: 42px;
    font-weight: 800;
    color: var(--text-bright);
    letter-spacing: -1px;
  }
  .welcome-logo span { color: var(--accent); }
  .welcome-sub {
    font-size: 13px;
    color: var(--text-dim);
    font-family: 'Syne', sans-serif;
  }
  .welcome-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .welcome-btn {
    background: var(--hover);
    border: 1px solid var(--border);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    font-size: 12px;
    font-weight: 600;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    transition: all .15s;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .welcome-btn:hover {
    background: var(--active);
    border-color: var(--accent);
    color: var(--accent);
  }

  /* SEARCH PANEL */
  #search-panel {
    padding: 10px;
    display: none;
  }
  #search-panel.active { display: block; }
  .search-input-wrap {
    display: flex;
    align-items: center;
    background: var(--editor-bg);
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 4px 8px;
    gap: 6px;
    margin-bottom: 8px;
  }
  .search-input-wrap input {
    background: none;
    border: none;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    outline: none;
    flex:1;
  }
  .search-input-wrap span { color: var(--text-dim); font-size: 13px; }
  .search-results { font-size: 11px; color: var(--text-dim); padding: 4px; }

  /* MINIMAP */
  #minimap {
    width: 60px;
    background: rgba(0,0,0,0.2);
    border-left: 1px solid var(--border);
    overflow: hidden;
    opacity: 0.4;
    flex-shrink: 0;
    font-size: 3px;
    line-height: 1.65;
    padding: 16px 4px;
    color: var(--text-dim);
    white-space: pre;
    pointer-events: none;
  }

  /* CONTEXT MENU */
  #ctx-menu {
    position: fixed;
    background: var(--sidebar-bg);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px;
    z-index: 9999;
    display: none;
    min-width: 160px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  }
  .ctx-item {
    padding: 6px 12px;
    font-size: 12px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background .1s;
    font-family: 'Syne', sans-serif;
  }
  .ctx-item:hover { background: var(--hover); color: var(--text-bright); }
  .ctx-sep { height: 1px; background: var(--border); margin: 4px; }
  .ctx-item .key { margin-left:auto; color: var(--text-dim); font-size: 10px; }

  /* TOOLTIPS */
  .tooltip {
    position: absolute;
    left: 52px;
    background: var(--sidebar-bg);
    color: var(--text-bright);
    font-size: 11px;
    font-family: 'Syne', sans-serif;
    padding: 4px 8px;
    border-radius: 4px;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    border: 1px solid var(--border);
    z-index: 100;
    transition: opacity .1s;
  }
  .act-btn:hover .tooltip { opacity: 1; }

  /* NOTIFICATIONS */
  #notif {
    position: fixed;
    bottom: 32px;
    right: 16px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 8px;
    pointer-events: none;
  }
  .notif-item {
    background: var(--sidebar-bg);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 6px;
    padding: 10px 14px;
    font-size: 12px;
    font-family: 'Syne', sans-serif;
    color: var(--text);
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    animation: slideIn .3s ease forwards;
    max-width: 280px;
  }
  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* RESIZER */
  .resizer {
    width: 4px;
    background: transparent;
    cursor: col-resize;
    flex-shrink: 0;
    transition: background .15s;
  }
  .resizer:hover { background: var(--accent); opacity: 0.4; }

  /* BREADCRUMB */
  #breadcrumb {
    height: 26px;
    background: var(--editor-bg);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 6px;
    font-size: 11px;
    color: var(--text-dim);
    font-family: 'Syne', sans-serif;
    flex-shrink: 0;
  }
  #breadcrumb .bc-sep { color: var(--border); }
  #breadcrumb .bc-current { color: var(--text); }
</style>
</head>
<body>

<!-- TITLE BAR -->
<div id="titlebar">
  <div class="logo">
    <img src="icon.png" alt="YSCode" onerror="this.style.display='none'">
    <span><em>Y</em>all<em>S</em>tudio<em>C</em>ode</span>
  </div>
  <div class="menu-bar">
    <button onclick="menuAction('file')">File</button>
    <button onclick="menuAction('edit')">Edit</button>
    <button onclick="menuAction('view')">View</button>
    <button onclick="menuAction('run')">Run</button>
    <button onclick="menuAction('terminal')">Terminal</button>
    <button onclick="menuAction('help')">Help</button>
  </div>
  <div class="title-center" id="title-center">YallStudioCode ‚Äî ysc.workspace</div>
  <div class="win-controls">
    <button class="win-btn win-close" title="Close"></button>
    <button class="win-btn win-min" title="Minimize"></button>
    <button class="win-btn win-max" title="Maximize"></button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app">

  <!-- ACTIVITY BAR -->
  <div id="activitybar">
    <div class="act-btn active" onclick="setActivity('explorer')" id="act-explorer" title="Explorer">
      üìÅ<span class="tooltip">Explorer</span>
    </div>
    <div class="act-btn" onclick="setActivity('search')" id="act-search" title="Search">
      üîç<span class="tooltip">Search</span>
    </div>
    <div class="act-btn" onclick="setActivity('git')" id="act-git" title="Source Control">
      üåø<span class="tooltip">Source Control</span>
    </div>
    <div class="act-btn" onclick="setActivity('run')" id="act-run" title="Run & Debug">
      ‚ñ∂Ô∏è<span class="tooltip">Run & Debug</span>
    </div>
    <div class="act-btn" onclick="setActivity('extensions')" id="act-ext" title="Extensions">
      üß©<span class="tooltip">Extensions</span>
    </div>
    <div class="spacer"></div>
    <div class="act-btn" onclick="notify('Settings coming soon! ü§†')" title="Settings">
      ‚öôÔ∏è<span class="tooltip">Settings</span>
    </div>
    <div class="act-btn" onclick="notify('Howdy, partner! ü§†')" title="Account">
      üë§<span class="tooltip">Account</span>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div id="sidebar">
    <!-- EXPLORER -->
    <div id="panel-explorer">
      <div class="sidebar-header">
        EXPLORER
        <div>
          <button class="icon-btn" onclick="newFile()" title="New File">+</button>
          <button class="icon-btn" onclick="newFolder()" title="New Folder">üìÅ</button>
          <button class="icon-btn" onclick="refreshTree()" title="Refresh">‚Üª</button>
        </div>
      </div>
      <div id="file-tree"></div>
    </div>
    <!-- SEARCH -->
    <div id="panel-search" style="display:none">
      <div class="sidebar-header">SEARCH</div>
      <div style="padding:10px">
        <div class="search-input-wrap">
          <span>üîç</span>
          <input type="text" placeholder="Search files..." id="search-input" oninput="doSearch(this.value)">
        </div>
        <div class="search-results" id="search-results">Type to search...</div>
      </div>
    </div>
    <!-- GIT -->
    <div id="panel-git" style="display:none">
      <div class="sidebar-header">SOURCE CONTROL</div>
      <div style="padding:12px;font-size:12px;color:var(--text-dim)">
        <div style="color:var(--accent3);margin-bottom:8px">‚úì No pending changes</div>
        <div style="color:var(--text-dim);font-size:11px">Branch: <span style="color:var(--accent)">main</span></div>
        <div style="margin-top:12px;font-size:11px">Last commit: <span style="color:var(--text)">init YSCode ü§†</span></div>
      </div>
    </div>
    <!-- RUN -->
    <div id="panel-run" style="display:none">
      <div class="sidebar-header">RUN & DEBUG</div>
      <div style="padding:12px;font-size:12px;color:var(--text-dim)">
        <button onclick="runCode()" style="background:var(--accent);color:#000;border:none;padding:8px 16px;border-radius:4px;font-family:'Syne',sans-serif;font-weight:700;cursor:pointer;font-size:12px;width:100%">‚ñ∂ Run Code</button>
        <div style="margin-top:12px;font-size:11px;color:var(--text-dim)">No debug config set</div>
      </div>
    </div>
    <!-- EXTENSIONS -->
    <div id="panel-extensions" style="display:none">
      <div class="sidebar-header">EXTENSIONS</div>
      <div style="padding:8px">
        <div class="tree-item" onclick="notify('Installing YeeHaw Theme... ü§†')">üé® YeeHaw Theme</div>
        <div class="tree-item" onclick="notify('Installing Prettier... ‚ú®')">‚ú® Prettier</div>
        <div class="tree-item" onclick="notify('Installing ESLint... üîç')">üîç ESLint</div>
        <div class="tree-item" onclick="notify('Installing Git Lens... üåø')">üåø GitLens</div>
        <div class="tree-item" onclick="notify('Installing Auto Import... üì¶')">üì¶ Auto Import</div>
        <div class="tree-item" onclick="notify('Installing Copilot... ü§ñ')">ü§ñ YSCopilot AI</div>
      </div>
    </div>
  </div>

  <div class="resizer" id="resizer-sidebar"></div>

  <!-- EDITOR + PANEL -->
  <div id="editor-area">
    <!-- TABS -->
    <div id="tabs"></div>

    <!-- BREADCRUMB -->
    <div id="breadcrumb">
      <span>YSCode</span>
      <span class="bc-sep">‚Ä∫</span>
      <span>src</span>
      <span class="bc-sep">‚Ä∫</span>
      <span class="bc-current" id="bc-file">welcome</span>
    </div>

    <!-- WELCOME or EDITOR WRAPPER -->
    <div id="welcome" style="display:flex">
      <div class="welcome-logo"><span>YS</span>Code</div>
      <div class="welcome-sub">YallStudioCode ‚Äî Code like a cowboy ü§†</div>
      <div class="welcome-actions">
        <button class="welcome-btn" onclick="openFile('index.html')">üìÑ New File</button>
        <button class="welcome-btn" onclick="openFile('app.js')">üìÇ Open Folder</button>
        <button class="welcome-btn" onclick="openFile('README.md')">üìñ README</button>
        <button class="welcome-btn" onclick="openFile('package.json')">üì¶ package.json</button>
      </div>
    </div>

    <div id="editor-wrapper" style="display:none; flex:1; overflow:hidden;">
      <div id="line-numbers"></div>
      <textarea id="editor" spellcheck="false"
        oninput="onEditorInput()"
        onkeydown="onEditorKeydown(event)"
        onclick="updateCursor()"
        onkeyup="updateCursor()"
        onscroll="syncScroll()"
      ></textarea>
      <div id="minimap"></div>
    </div>

    <!-- BOTTOM PANEL -->
    <div id="panel">
      <div class="panel-tabs">
        <div class="panel-tab active" onclick="switchPanel('terminal')">TERMINAL</div>
        <div class="panel-tab" onclick="switchPanel('problems')">PROBLEMS <span id="prob-count" style="background:var(--accent2);color:white;border-radius:8px;padding:0 5px;font-size:10px;margin-left:4px">0</span></div>
        <div class="panel-tab" onclick="switchPanel('output')">OUTPUT</div>
        <div style="margin-left:auto;padding-right:8px">
          <button style="background:none;border:none;color:var(--text-dim);cursor:pointer;font-size:14px" onclick="togglePanel()">‚úï</button>
        </div>
      </div>
      <div id="terminal"></div>
      <div id="term-input-line">
        <span class="term-input-prompt">ysc@YallStudioCode:~$</span>
        <input type="text" id="term-input" placeholder="Type a command..." onkeydown="handleTermInput(event)" autocomplete="off">
      </div>
    </div>
  </div>

</div>

<!-- STATUS BAR -->
<div id="statusbar">
  <div class="status-item" onclick="notify('Branch: main ‚úì')">üåø main</div>
  <div class="status-item" id="status-errors" onclick="switchPanel('problems')">‚ö†Ô∏è 0 errors</div>
  <div class="status-item status-right">
    <span id="status-lang">HTML</span>
  </div>
  <div class="status-item">
    <span id="status-cursor">Ln 1, Col 1</span>
  </div>
  <div class="status-item">
    <span>UTF-8</span>
  </div>
  <div class="status-item">
    <span>CRLF</span>
  </div>
  <div class="status-item" onclick="notify('YSCode v1.0.0 ‚Äî Yeehaw! ü§†')">
    YSCode v1.0.0
  </div>
</div>

<!-- CONTEXT MENU -->
<div id="ctx-menu">
  <div class="ctx-item" onclick="ctxAction('cut')">‚úÇÔ∏è Cut <span class="key">‚åòX</span></div>
  <div class="ctx-item" onclick="ctxAction('copy')">üìã Copy <span class="key">‚åòC</span></div>
  <div class="ctx-item" onclick="ctxAction('paste')">üìå Paste <span class="key">‚åòV</span></div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" onclick="ctxAction('format')">‚ú® Format Document</div>
  <div class="ctx-item" onclick="ctxAction('comment')">üí¨ Toggle Comment</div>
  <div class="ctx-sep"></div>
  <div class="ctx-item" onclick="ctxAction('rename')">‚úèÔ∏è Rename Symbol</div>
  <div class="ctx-item" onclick="ctxAction('find')">üîç Find References</div>
</div>

<!-- NOTIFICATIONS -->
<div id="notif"></div>

<script>
// ===================== STATE =====================
const state = {
  files: {},
  activeFile: null,
  openTabs: [],
  termHistory: [],
  termHistIdx: -1,
  panelVisible: true,
};

const DEFAULT_FILES = {
  'index.html': `<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <title>My App</title>\n  <link rel="stylesheet" href="style.css">\n</head>\n<body>\n  <h1>Hello, World! ü§†</h1>\n  <p>Welcome to YallStudioCode.</p>\n  <script src="app.js"><\/script>\n</body>\n</html>`,
  'style.css': `/* === YSCode Styles === */\n\nbody {\n  font-family: 'Syne', sans-serif;\n  background: #0f0f10;\n  color: #d4d4d8;\n  margin: 0;\n  padding: 40px;\n}\n\nh1 {\n  color: #f5a623;\n  font-size: 2.5rem;\n}\n\np {\n  color: #71717a;\n  margin-top: 12px;\n}`,
  'app.js': `// === app.js ===\n\nconsole.log('YSCode is alive! ü§†');\n\nconst greet = (name) => {\n  return \`Howdy, \${name}! Welcome to YallStudioCode.\`;\n};\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log(greet('partner'));\n  const h1 = document.querySelector('h1');\n  if (h1) h1.addEventListener('click', () => {\n    alert('Yeehaw! ü§†');\n  });\n});`,
  'README.md': `# YallStudioCode (YSCode)\n\n> Code like a cowboy ü§†\n\n## Features\n\n- Syntax highlighting\n- Multi-tab editing\n- Integrated terminal\n- File explorer\n- Git integration\n- Extensions marketplace\n\n## Getting Started\n\n\`\`\`bash\n# Open a project\nysc open my-project\n\n# Run code\nysc run\n\`\`\`\n\n## License\n\nMIT ‚Äî Yee-haw!`,
  'package.json': `{\n  "name": "my-yscode-project",\n  "version": "1.0.0",\n  "description": "Built with YallStudioCode ü§†",\n  "main": "app.js",\n  "scripts": {\n    "start": "node app.js",\n    "dev": "nodemon app.js",\n    "build": "webpack --mode production",\n    "test": "jest"\n  },\n  "keywords": ["yscode", "yeehaw"],\n  "author": "A Cowboy Coder",\n  "license": "MIT",\n  "dependencies": {}\n}`,
  'config.yml': `# YSCode Configuration\nyscode:\n  version: 1.0.0\n  theme: yee-haw-dark\n  font: JetBrains Mono\n  fontSize: 13\n  tabSize: 2\n  wordWrap: off\n  minimap: true\n  terminal:\n    shell: /bin/bash\n    fontSize: 12`,
};

// Copy files to state
Object.assign(state.files, DEFAULT_FILES);

// ===================== FILE ICONS =====================
function getIcon(filename) {
  const ext = filename.split('.').pop().toLowerCase();
  const icons = {
    html: 'üåê', css: 'üé®', js: 'üü®', ts: 'üî∑', jsx: '‚öõÔ∏è', tsx: '‚öõÔ∏è',
    json: 'üì¶', md: 'üìñ', yml: '‚öôÔ∏è', yaml: '‚öôÔ∏è', py: 'üêç',
    rs: 'ü¶Ä', go: 'üêπ', java: '‚òï', cpp: '‚öôÔ∏è', c: '‚öôÔ∏è',
    sh: 'üíª', txt: 'üìÑ', png: 'üñºÔ∏è', jpg: 'üñºÔ∏è', svg: 'üé®',
    gif: 'üñºÔ∏è', mp4: 'üé¨', mp3: 'üéµ',
  };
  return icons[ext] || 'üìÑ';
}

function getLang(filename) {
  const ext = filename.split('.').pop().toLowerCase();
  const langs = {
    html: 'HTML', css: 'CSS', js: 'JavaScript', ts: 'TypeScript',
    jsx: 'JSX', tsx: 'TSX', json: 'JSON', md: 'Markdown',
    yml: 'YAML', yaml: 'YAML', py: 'Python', rs: 'Rust',
    go: 'Go', java: 'Java', sh: 'Shell', txt: 'Plain Text',
  };
  return langs[ext] || 'Plain Text';
}

// ===================== FILE TREE =====================
function buildTree() {
  const tree = document.getElementById('file-tree');
  tree.innerHTML = '';

  // Folder header
  const folder = document.createElement('div');
  folder.className = 'tree-item tree-folder open';
  folder.innerHTML = `<span class="arrow">‚ñ∂</span> üìÅ <span>YSCode Project</span>`;
  folder.onclick = function() {
    this.classList.toggle('open');
    [...tree.querySelectorAll('.tree-file')].forEach(f => {
      f.style.display = this.classList.contains('open') ? '' : 'none';
    });
  };
  tree.appendChild(folder);

  Object.keys(state.files).forEach(name => {
    const item = document.createElement('div');
    item.className = 'tree-item tree-file' + (state.activeFile === name ? ' active' : '');
    item.dataset.file = name;
    item.innerHTML = `<span class="fi">${getIcon(name)}</span> ${name}`;
    item.onclick = () => openFile(name);
    item.oncontextmenu = (e) => { e.preventDefault(); showCtxMenu(e, name); };
    tree.appendChild(item);
  });
}

function refreshTree() {
  buildTree();
  notify('File tree refreshed ‚Üª');
}

// ===================== TABS =====================
function buildTabs() {
  const tabsEl = document.getElementById('tabs');
  tabsEl.innerHTML = '';
  state.openTabs.forEach(name => {
    const tab = document.createElement('div');
    tab.className = 'tab' + (state.activeFile === name ? ' active' : '');
    tab.dataset.file = name;
    tab.innerHTML = `
      <span class="tab-icon">${getIcon(name)}</span>
      <span>${name}</span>
      <span class="close" onclick="closeTab(event,'${name}')">‚úï</span>
    `;
    tab.onclick = (e) => { if (!e.target.classList.contains('close')) openFile(name); };
    tabsEl.appendChild(tab);
  });
  // New tab button
  const newTab = document.createElement('div');
  newTab.className = 'tab-new';
  newTab.title = 'New File';
  newTab.textContent = '+';
  newTab.onclick = newFile;
  tabsEl.appendChild(newTab);
}

// ===================== EDITOR =====================
function openFile(name) {
  // Show editor, hide welcome
  document.getElementById('welcome').style.display = 'none';
  document.getElementById('editor-wrapper').style.display = 'flex';

  if (!state.files[name]) {
    state.files[name] = `// New file: ${name}\n`;
  }

  state.activeFile = name;
  if (!state.openTabs.includes(name)) state.openTabs.push(name);

  const editor = document.getElementById('editor');
  editor.value = state.files[name];

  buildTabs();
  buildTree();
  updateLineNumbers();
  updateMinimap();
  updateCursor();
  document.getElementById('bc-file').textContent = name;
  document.getElementById('status-lang').textContent = getLang(name);
  document.getElementById('title-center').textContent = `YallStudioCode ‚Äî ${name}`;
  editor.focus();
}

function closeTab(e, name) {
  e.stopPropagation();
  const idx = state.openTabs.indexOf(name);
  state.openTabs.splice(idx, 1);

  if (state.activeFile === name) {
    if (state.openTabs.length > 0) {
      openFile(state.openTabs[Math.min(idx, state.openTabs.length - 1)]);
    } else {
      state.activeFile = null;
      document.getElementById('welcome').style.display = 'flex';
      document.getElementById('editor-wrapper').style.display = 'none';
      document.getElementById('title-center').textContent = 'YallStudioCode ‚Äî ysc.workspace';
    }
  }
  buildTabs();
  buildTree();
}

function onEditorInput() {
  if (!state.activeFile) return;
  state.files[state.activeFile] = document.getElementById('editor').value;
  updateLineNumbers();
  updateMinimap();
  checkProblems();
}

function onEditorKeydown(e) {
  const editor = document.getElementById('editor');

  // TAB key
  if (e.key === 'Tab') {
    e.preventDefault();
    const start = editor.selectionStart;
    const end = editor.selectionEnd;
    editor.value = editor.value.substring(0, start) + '  ' + editor.value.substring(end);
    editor.selectionStart = editor.selectionEnd = start + 2;
    onEditorInput();
  }

  // SAVE
  if ((e.ctrlKey || e.metaKey) && e.key === 's') {
    e.preventDefault();
    saveFile();
  }

  // Auto-close brackets
  const pairs = { '(': ')', '[': ']', '{': '}', '"': '"', "'": "'" };
  if (pairs[e.key]) {
    const start = editor.selectionStart;
    const end = editor.selectionEnd;
    if (start === end) {
      e.preventDefault();
      const v = editor.value;
      editor.value = v.substring(0, start) + e.key + pairs[e.key] + v.substring(end);
      editor.selectionStart = editor.selectionEnd = start + 1;
      onEditorInput();
    }
  }
}

function updateLineNumbers() {
  const editor = document.getElementById('editor');
  const lines = editor.value.split('\n');
  const ln = document.getElementById('line-numbers');
  ln.innerHTML = lines.map((_, i) => `<div>${i + 1}</div>`).join('');

  // Sync scroll
  ln.scrollTop = editor.scrollTop;
}

function syncScroll() {
  const editor = document.getElementById('editor');
  document.getElementById('line-numbers').scrollTop = editor.scrollTop;
}

function updateMinimap() {
  const editor = document.getElementById('editor');
  document.getElementById('minimap').textContent = editor.value;
}

function updateCursor() {
  const editor = document.getElementById('editor');
  const val = editor.value.substring(0, editor.selectionStart);
  const lines = val.split('\n');
  const ln = lines.length;
  const col = lines[lines.length - 1].length + 1;
  document.getElementById('status-cursor').textContent = `Ln ${ln}, Col ${col}`;
}

function saveFile() {
  if (!state.activeFile) return;
  notify(`‚úì Saved ${state.activeFile}`);
  // Flash the tab
  const tab = document.querySelector(`.tab[data-file="${state.activeFile}"]`);
  if (tab) {
    tab.style.borderBottomColor = 'var(--accent3)';
    setTimeout(() => { tab.style.borderBottomColor = ''; }, 600);
  }
}

// ===================== PROBLEMS =====================
function checkProblems() {
  let count = 0;
  if (state.activeFile) {
    const val = state.files[state.activeFile];
    // Naive checks
    const unclosed = (val.match(/\{/g) || []).length - (val.match(/\}/g) || []).length;
    if (unclosed !== 0) count++;
    const unclosedP = (val.match(/\(/g) || []).length - (val.match(/\)/g) || []).length;
    if (unclosedP !== 0) count++;
  }
  document.getElementById('prob-count').textContent = count;
  document.getElementById('status-errors').innerHTML = `‚ö†Ô∏è ${count} errors`;
}

// ===================== TERMINAL =====================
const termOutputs = {
  'ls': () => Object.keys(state.files).join('  '),
  'pwd': () => '/home/cowboy/YSCode',
  'whoami': () => 'cowboy',
  'date': () => new Date().toString(),
  'node -v': () => 'v20.11.0',
  'npm -v': () => '10.2.4',
  'git status': () => 'On branch main\nnothing to commit, working tree clean',
  'git log --oneline': () => 'a1b2c3d init YSCode ü§†\nb2c3d4e add styles\nc3d4e5f initial commit',
  'clear': () => { document.getElementById('terminal').innerHTML = ''; return null; },
  'help': () => 'Available commands: ls, pwd, whoami, date, node -v, npm -v, git status, git log --oneline, clear, run, cat [file]',
  'run': () => { runCode(); return '‚ñ∂ Running...'; },
  'yee': () => 'ü§† HAW!',
  'yeehaw': () => 'ü§†ü§†ü§† YEEEE-HAWWW! ü§†ü§†ü§†',
};

function termPrint(html, cls = '') {
  const term = document.getElementById('terminal');
  const line = document.createElement('div');
  line.className = `term-line ${cls}`;
  line.innerHTML = html;
  term.appendChild(line);
  term.scrollTop = term.scrollHeight;
}

function handleTermInput(e) {
  const input = document.getElementById('term-input');

  if (e.key === 'ArrowUp') {
    e.preventDefault();
    if (state.termHistIdx < state.termHistory.length - 1) {
      state.termHistIdx++;
      input.value = state.termHistory[state.termHistory.length - 1 - state.termHistIdx];
    }
    return;
  }
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    if (state.termHistIdx > 0) {
      state.termHistIdx--;
      input.value = state.termHistory[state.termHistory.length - 1 - state.termHistIdx];
    } else {
      state.termHistIdx = -1;
      input.value = '';
    }
    return;
  }

  if (e.key !== 'Enter') return;

  const cmd = input.value.trim();
  input.value = '';
  state.termHistIdx = -1;

  if (!cmd) return;

  state.termHistory.push(cmd);

  termPrint(`<span class="term-prompt">ysc@YallStudioCode</span>:<span class="term-path">~/YSCode</span>$ <span style="color:var(--text-bright)">${cmd}</span>`);

  // Handle cat command
  if (cmd.startsWith('cat ')) {
    const fname = cmd.slice(4).trim();
    if (state.files[fname]) {
      termPrint(`<pre style="color:var(--text-dim);font-size:11px;white-space:pre-wrap">${escHtml(state.files[fname])}</pre>`);
    } else {
      termPrint(`cat: ${fname}: No such file or directory`, 'term-error');
    }
    return;
  }

  // Handle echo
  if (cmd.startsWith('echo ')) {
    termPrint(escHtml(cmd.slice(5)), 'term-output');
    return;
  }

  const handler = termOutputs[cmd.toLowerCase()];
  if (handler) {
    const out = handler();
    if (out !== null && out !== undefined) {
      termPrint(`<span class="term-output" style="white-space:pre-wrap">${escHtml(out)}</span>`);
    }
  } else {
    termPrint(`<span class="term-error">ysc: command not found: ${escHtml(cmd)}</span><span class="term-output"> ‚Äî Try 'help'</span>`);
  }
}

function escHtml(str) {
  return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function switchPanel(name) {
  document.querySelectorAll('.panel-tab').forEach((t,i) => {
    t.classList.toggle('active', ['terminal','problems','output'][i] === name);
  });
  if (name === 'terminal') {
    document.getElementById('term-input').focus();
  }
}

function togglePanel() {
  const panel = document.getElementById('panel');
  state.panelVisible = !state.panelVisible;
  panel.style.display = state.panelVisible ? '' : 'none';
}

function runCode() {
  switchPanel('terminal');
  termPrint(`<span class="term-prompt">ysc@YallStudioCode</span>:<span class="term-path">~/YSCode</span>$ <span style="color:var(--text-bright)">ysc run</span>`);
  termPrint(`<span style="color:var(--accent3)">‚ñ∂ Running ${state.activeFile || 'project'}...</span>`);
  setTimeout(() => termPrint(`<span class="term-output">YSCode is alive! ü§†</span>`), 300);
  setTimeout(() => termPrint(`<span class="term-output">Howdy, partner! Welcome to YallStudioCode.</span>`), 600);
  setTimeout(() => termPrint(`<span style="color:var(--accent3)">‚úì Process exited with code 0</span>`), 900);
}

// ===================== ACTIVITY BAR =====================
function setActivity(name) {
  const map = { explorer: 'act-explorer', search: 'act-search', git: 'act-git', run: 'act-run', extensions: 'act-ext' };
  const panelMap = { explorer: 'panel-explorer', search: 'panel-search', git: 'panel-git', run: 'panel-run', extensions: 'panel-extensions' };

  document.querySelectorAll('.act-btn').forEach(b => b.classList.remove('active'));
  Object.values(panelMap).forEach(p => { const el = document.getElementById(p); if(el) el.style.display = 'none'; });

  document.getElementById(map[name])?.classList.add('active');
  const panel = document.getElementById(panelMap[name]);
  if (panel) panel.style.display = '';

  if (name === 'run') runCode();
}

// ===================== SEARCH =====================
function doSearch(query) {
  const results = document.getElementById('search-results');
  if (!query) { results.textContent = 'Type to search...'; return; }
  let found = [];
  Object.entries(state.files).forEach(([name, content]) => {
    const lines = content.split('\n');
    lines.forEach((line, idx) => {
      if (line.toLowerCase().includes(query.toLowerCase())) {
        found.push(`<div class="tree-item" onclick="openFile('${name}')" style="font-size:11px">
          ${getIcon(name)} <b>${name}</b>:${idx+1} ‚Äî <span style="color:var(--text-dim)">${escHtml(line.trim().substring(0,40))}</span>
        </div>`);
      }
    });
  });
  results.innerHTML = found.length ? found.join('') : `<div style="color:var(--text-dim)">No results for "${escHtml(query)}"</div>`;
}

// ===================== NEW FILE / FOLDER =====================
function newFile() {
  const name = prompt('New file name:', 'untitled.js');
  if (!name) return;
  state.files[name] = `// ${name}\n`;
  buildTree();
  openFile(name);
  notify(`Created ${name}`);
}

function newFolder() {
  notify('Folder support coming soon! ü§†');
}

// ===================== CONTEXT MENU =====================
let ctxTargetFile = null;

function showCtxMenu(e, file) {
  ctxTargetFile = file;
  const menu = document.getElementById('ctx-menu');
  menu.style.display = 'block';
  menu.style.left = e.clientX + 'px';
  menu.style.top = e.clientY + 'px';
}

document.addEventListener('click', () => {
  document.getElementById('ctx-menu').style.display = 'none';
});

function ctxAction(action) {
  const editor = document.getElementById('editor');
  if (action === 'cut') document.execCommand('cut');
  else if (action === 'copy') document.execCommand('copy');
  else if (action === 'paste') document.execCommand('paste');
  else if (action === 'format') { formatDocument(); }
  else if (action === 'comment') { toggleComment(); }
  else if (action === 'rename') {
    const name = prompt('Rename to:', state.activeFile);
    if (name && name !== state.activeFile) {
      state.files[name] = state.files[state.activeFile];
      delete state.files[state.activeFile];
      const idx = state.openTabs.indexOf(state.activeFile);
      if (idx !== -1) state.openTabs[idx] = name;
      state.activeFile = name;
      buildTree();
      buildTabs();
      notify(`Renamed to ${name}`);
    }
  }
  else if (action === 'find') notify('Find references: feature coming soon!');
}

function formatDocument() {
  notify('‚ú® Document formatted');
}

function toggleComment() {
  const editor = document.getElementById('editor');
  const start = editor.selectionStart;
  const lineStart = editor.value.lastIndexOf('\n', start - 1) + 1;
  const line = editor.value.substring(lineStart);
  const firstLine = line.split('\n')[0];
  const trimmed = firstLine.trimStart();
  const isComment = trimmed.startsWith('//');
  const newLine = isComment ? firstLine.replace(/^(\s*)\/\/\s?/, '$1') : firstLine.replace(/^(\s*)/, '$1// ');
  editor.value = editor.value.substring(0, lineStart) + newLine + editor.value.substring(lineStart + firstLine.length);
  onEditorInput();
  notify('üí¨ Comment toggled');
}

// ===================== MENU ACTIONS =====================
function menuAction(menu) {
  const actions = {
    file: () => {
      const choice = ['New File', 'Open File', 'Save', 'Save All', 'Close Editor'];
      notify('File menu: ' + choice[Math.floor(Math.random()*choice.length)]);
    },
    edit: () => notify('Edit menu opened'),
    view: () => notify('Toggle: Sidebar / Panel / Minimap'),
    run: () => runCode(),
    terminal: () => { togglePanel(); notify('Terminal toggled'); },
    help: () => notify('YallStudioCode v1.0.0 ü§† ‚Äî Ride into the code!'),
  };
  actions[menu]?.();
}

// ===================== NOTIFICATIONS =====================
function notify(msg) {
  const notif = document.getElementById('notif');
  const item = document.createElement('div');
  item.className = 'notif-item';
  item.textContent = msg;
  notif.appendChild(item);
  setTimeout(() => {
    item.style.opacity = '0';
    item.style.transform = 'translateX(100%)';
    item.style.transition = 'all .3s';
    setTimeout(() => item.remove(), 300);
  }, 2500);
}

// ===================== SIDEBAR RESIZE =====================
const resizer = document.getElementById('resizer-sidebar');
let isResizing = false;
resizer.addEventListener('mousedown', e => {
  isResizing = true;
  document.body.style.cursor = 'col-resize';
});
document.addEventListener('mousemove', e => {
  if (!isResizing) return;
  const sidebar = document.getElementById('sidebar');
  const actbar = document.getElementById('activitybar');
  const newW = e.clientX - actbar.offsetWidth - 4;
  if (newW > 100 && newW < 400) sidebar.style.width = newW + 'px';
});
document.addEventListener('mouseup', () => {
  isResizing = false;
  document.body.style.cursor = '';
});

// ===================== INIT =====================
buildTree();
buildTabs();

// Initial terminal welcome
termPrint(`<span style="color:var(--accent);font-family:'Syne',sans-serif;font-weight:700">YallStudioCode Terminal</span> <span style="color:var(--text-dim)">v1.0.0 ü§†</span>`);
termPrint(`<span class="term-output">Type 'help' for available commands</span>`);
termPrint(``);

// Open first file by default
openFile('index.html');

// Keyboard shortcuts
document.addEventListener('keydown', e => {
  if ((e.ctrlKey || e.metaKey) && e.key === 's') { e.preventDefault(); saveFile(); }
  if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
    e.preventDefault();
    const name = prompt('Open file:', Object.keys(state.files).join(', '));
    if (name && state.files[name]) openFile(name);
  }
  if ((e.ctrlKey || e.metaKey) && e.key === '`') {
    e.preventDefault();
    togglePanel();
  }
  if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
    e.preventDefault();
    newFile();
  }
});
</script>
</body>
</html>
